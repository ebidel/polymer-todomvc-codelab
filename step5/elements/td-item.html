<!--
TODO
1. Using the attributes attribute, include another published property: "editing".
2. Add a on-blur handler on the <element> that calls commitAction().
3. Modify <div class="view {{completed: item.completed;}}">:
   - update the conditional expression for class so "editing" is also applied when the element's editing property is true: class="view {{completed: item.completed; editing: editing}}">
  - Conditionally apply the hidden attribute if the editing property is true.
  - Add a on-dblclick="editAction" to the element.
- At the bottom of the <template>, add an input for editing:
  <input id="edit" class="edit" value="{{title}}" hidden?="{{!editing}}" on-keyup="keyAction">
-->

<polymer-element name="td-item" extends="li" attributes="item">
  <template>
	<link rel="stylesheet" href="td-item.css">
    <div class="view {{completed: item.completed;}}">
      <input type="checkbox" class="toggle" checked="{{item.completed}}" on-click="itemChangeAction">
      <label>{{item.title}}</label>
      <button class="destroy" on-click="destroyAction"></button>
    </div>
  </template>
  <script>
    var ENTER_KEY = 13;
    var ESC_KEY = 27;
    Polymer('td-item', {
      editing: false,
      keyAction: function(e) {
        switch (e.keyCode) {
          case ESC_KEY:
            this.cancelAction();
            break;
          case ENTER_KEY:
            this.commitAction();
            break;
        }
      },
      editAction: function() {
        this.editing = true;
        this.title = this.item.title;
        // schedule focus for the end of microtask, when the input will be visible
        Platform.flush();
        this.asyncMethod(function() {
          this.$.edit.focus();
        });
      },
      commitAction: function() {
        if (this.editing) {
          this.editing = false;
          this.item.title = this.title.trim();
          if (this.item.title === '') {
            this.destroyAction();
          }
        }
      },
      cancelAction: function() {
        this.editing = false;
      },
      itemChangeAction: function() {
        this.fire('td-item-changed');
      },
      destroyAction: function() {
        this.fire('td-destroy-item', this.item);
      }
    });
  </script>
</polymer-element>
